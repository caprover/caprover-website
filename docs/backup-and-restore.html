<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Backup &amp; Restore · CapRover</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="### Backup &amp; Restore"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Backup &amp; Restore · CapRover"/><meta property="og:type" content="website"/><meta property="og:url" content="https://caprover.com/index.html"/><meta property="og:description" content="### Backup &amp; Restore"/><meta property="og:image" content="https://caprover.com/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://caprover.com/img/logo.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-132762521-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="CapRover"/><h2 class="headerTitleWithLogo">CapRover</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/get-started.html" target="_self">Docs</a></li><li class=""><a href="https://github.com/caprover/caprover" target="_self">GitHub</a></li><li class=""><a href="https://join.slack.com/t/caprover/shared_invite/zt-2qlb28drp-RpxNfY3nUhroLuRJUUJzDA" target="_self">Slack Group</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recipes and Tips</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Basics</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/get-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/cdd-migration.html">CaptainDuckDuck Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/captain-definition-file.html">Captain Definition File</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment-methods.html">Deployment Methods</a></li><li class="navListItem"><a class="navItem" href="/docs/app-configuration.html">App Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/persistent-apps.html">Persistent Apps</a></li><li class="navListItem"><a class="navItem" href="/docs/cli-commands.html">CLI Commands</a></li><li class="navListItem"><a class="navItem" href="/docs/one-click-apps.html">One-Click Apps</a></li><li class="navListItem"><a class="navItem" href="/docs/complete-webapp-tutorial.html">Complete Webapp Tutorial</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Do More</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/resource-monitoring.html">Resource Monitoring</a></li><li class="navListItem"><a class="navItem" href="/docs/nginx-customization.html">NGINX Config</a></li><li class="navListItem"><a class="navItem" href="/docs/service-update-override.html">Service Update Override</a></li><li class="navListItem"><a class="navItem" href="/docs/app-scaling-and-cluster.html">App Scaling &amp; Cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/pre-deploy-script.html">Pre-deploy Script</a></li><li class="navListItem"><a class="navItem" href="/docs/play-with-docker.html">Play with CapRover</a></li><li class="navListItem"><a class="navItem" href="/docs/run-locally.html">Run Locally</a></li><li class="navListItem"><a class="navItem" href="/docs/certbot-config.html">Certbot Overrides</a></li><li class="navListItem"><a class="navItem" href="/docs/theme-customization.html">Custom Themes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Recipes and Tips</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/sample-apps.html">Sample Apps</a></li><li class="navListItem"><a class="navItem" href="/docs/zero-downtime.html">Zero Downtime</a></li><li class="navListItem"><a class="navItem" href="/docs/database-connection.html">Database Connection</a></li><li class="navListItem"><a class="navItem" href="/docs/best-practices.html">Best Practices</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/backup-and-restore.html">Backup &amp; Restore</a></li><li class="navListItem"><a class="navItem" href="/docs/recipe-deploy-create-react-app.html">Static React App</a></li><li class="navListItem"><a class="navItem" href="/docs/stateless-with-persistent-data.html">Stateless with Persistent data</a></li><li class="navListItem"><a class="navItem" href="/docs/docker-compose.html">Docker Compose</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">CI/CD Integration</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ci-cd-integration.html">Intro</a></li><li class="navListItem"><a class="navItem" href="/docs/ci-cd-integration/deploy-from-github.html">Deploy from GitHub</a></li><li class="navListItem"><a class="navItem" href="/docs/ci-cd-integration/deploy-from-gitlab.html">Deploy from GitLab</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Help</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Server Purchase</h4><ul><li class="navListItem"><a class="navItem" href="/docs/server-purchase/digitalocean.html">DigitalOcean</a></li><li class="navListItem"><a class="navItem" href="/docs/server-purchase/openstack.html">OpenStack</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/disk-cleanup.html">Disk Clean-Up</a></li><li class="navListItem"><a class="navItem" href="/docs/firewall.html">Firewall &amp; Port Forwarding</a></li><li class="navListItem"><a class="navItem" href="/docs/troubleshooting.html">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/docs/troubleshooting-pro.html">Troubleshooting (Pro)</a></li><li class="navListItem"><a class="navItem" href="/docs/support.html">Help and Support</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/caprover/caprover-website/edit/master/docs/backup-and-restore.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Backup &amp; Restore</h1></header><article><div><span><h3><a class="anchor" aria-hidden="true" id="backup--restore"></a><a href="#backup--restore" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Backup &amp; Restore</h3>
<p><em>This feature was added in v1.3.0.</em></p>
<p><em>Backup/Restore feature is still in experimental stage. More changes to come in the future.</em></p>
<p>Backup/restoration is a complicated process and requires understanding of how different components work in CapRover instance. If you plan to use this feature, make sure you read this document thoroughly, and practice with a test server and learn the process before actually using this feature in production.</p>
<p><strong>TDLR;</strong> Normal backup/restore works for everything except images and volumes. For images, you have to use a Docker Registry (has pros and cons), for volumes, you have to use a custom solution (has pros and cons).</p>
<h3><a class="anchor" aria-hidden="true" id="backup-process"></a><a href="#backup-process" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Backup Process</h3>
<p>On your working CapRover instance, open the web dashboard, navigate to settings page, and click on &quot;Create Backup&quot; button. After a few seconds download will start. Keep the tar file and you will use this when restoring the CapRover instance.</p>
<h4><a class="anchor" aria-hidden="true" id="automating-backup-process"></a><a href="#automating-backup-process" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Automating backup process</h4>
<p>You can create a simple bash script for automated backups:</p>
<pre><code class="hljs css language-bash">    API_TOKEN=$(curl <span class="hljs-variable">$CAPROVER_URL</span>/api/v2/login \
        -H <span class="hljs-string">'x-namespace: captain'</span> \
        -H <span class="hljs-string">'content-type: application/json;charset=UTF-8'</span> \
        --data-raw <span class="hljs-string">"{\"password\":\"<span class="hljs-variable">$CAPROVER_PASSWORD</span>\"}"</span> \
        --compressed --silent | jq -r <span class="hljs-string">".data.token"</span>)

    DOWNLOAD_TOKEN=$(curl <span class="hljs-variable">$CAPROVER_URL</span>/api/v2/user/system/createbackup \
        -H <span class="hljs-string">"x-captain-auth: <span class="hljs-variable">$API_TOKEN</span>"</span> \
        -H <span class="hljs-string">'x-namespace: captain'</span> \
        --data-raw <span class="hljs-string">'{"postDownloadFileName":"backup.tar"}'</span> \
        --compressed --silent | jq -r <span class="hljs-string">".data.downloadToken"</span>)

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#DOWNLOAD_TOKEN}</span> -le 10 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"DOWNLOAD_TOKEN must be at least 10 char long"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>

    wget <span class="hljs-string">"<span class="hljs-variable">$CAPROVER_URL</span>/api/v2/downloads/?namespace=captain&amp;downloadToken=<span class="hljs-variable">$DOWNLOAD_TOKEN</span>"</span> -O backup.tar
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="restoration-process"></a><a href="#restoration-process" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Restoration Process</h3>
<p>This process is very similar to fresh installation of CapRover, except a few differences. Follow the steps for Prerequisites from <a href="/docs/get-started.html">Get Started</a>, and make sure you have Docker installed on a server.</p>
<p><em>DO NOT</em> run the installation command <code>docker run -p 80:80 -p 443:443.....</code>. Instead do the following steps:</p>
<p><em>(replace 123.123.123.123 with your server IP in instructions below)</em></p>
<ol>
<li>Create an empty <code>/captain</code> directory on your server by running <br/> <code>ssh root@123.123.123.123 mkdir /captain</code></li>
<li>Rename your desired backup file to <code>backup.tar</code> on your desktop.</li>
<li>Copy <code>backup.tar</code> to server: <br/> <code>scp ./backup.tar root@123.123.123.123:/captain/</code></li>
<li>Install CapRover:</li>
</ol>
<pre><code class="hljs css language-bash">docker run -p 80:80 -p 443:443 -p 3000:3000 -e ACCEPTED_TERMS=<span class="hljs-literal">true</span> -v /var/run/docker.sock:/var/run/docker.sock -v /captain:/captain caprover/caprover
</code></pre>
<p>CapRover will automatically detect your <code>backup.tar</code>, extract it and restores all your configs and settings.</p>
<ol start="5">
<li>You need to configure your DNS such that <code>*.youroldroot.domain.com</code> points to the new server IP.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="keeping-old-server"></a><a href="#keeping-old-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keeping Old Server</h3>
<p>In some cases, you still have the previous server running, and you just want to create a clone of your server. Since you want your old server to keep running, you shouldn't change your DNS for the old domain. Instead, you want to assign a new one. In this case:</p>
<ol>
<li>Create a new wildcard entry in your DNS <code>*.yournewroot.domain.com</code> and point it to the new server</li>
<li>On your desktop machine, create a temporary entry in your <code>etc/hosts</code> file and add this line</li>
</ol>
<pre><code class="hljs"><span class="hljs-selector-tag">NEW-SERVER-IP-ADDRESS</span>   <span class="hljs-selector-tag">captain</span><span class="hljs-selector-class">.oldroot</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span>
</code></pre>
<p>NOTE that you cannot use wild card in hosts file, just add the domain for the dashboard so you can access it temporarily.</p>
<ol start="3">
<li>go to <code>captain.oldroot.domain.com</code> in your browser and login to the dashboard.</li>
</ol>
<p>NOTE that you might see an SSL error, you can click on advance and ignore. This is fine as your SSL certification might have been expired. It will get renewed once you set everything up and restart CapRover.</p>
<ol start="4">
<li><p>After logging in to the dashboard, go ahead and change your root domain to <code>yournewroot.domain.com</code> on the dashboard.</p></li>
<li><p>Re-enable SSL certifications and Force HTTPS for your dashboard and other apps if you want.</p></li>
<li><p>Edit your <code>etc/hosts</code> and remove the line you added in step 2.</p></li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="what-is-restored"></a><a href="#what-is-restored" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is Restored?</h3>
<p>CapRover backup process backs up everything in your <code>/captain/data/</code> directory. This includes your app settings, configurations, SSL certificates and etc. What it does not include are: <strong>Container Images</strong> and <strong>Persistent Directories</strong></p>
<ol>
<li><strong>Container Images:</strong> After restoring an instance of CapRover, you will notice that your app configurations are set, however, all your apps are reverted to the default state of &quot;Your App Will Be Here!&quot;. You do need to redeploy all your apps. The good things about this approach is that your <code>backup.tar</code> file is really small and manageable. The cons of this approach, of course, is having to perform a re-deploy for all your apps. If you really want the images to be saved in a backup, you need to use a <a href="#d-r">Docker Registry</a>.</li>
<li><strong>Persistent Directories:</strong> Some apps, like databases, have a persistent directory. Since each database has its own backup mechanism. It is recommended to use the proper method of backup for your specific database, like <code>mongodump</code> for MongoDB or <code>mysqldump</code> for MySQL and etc. This is the best approach for databases as it does not cause a down time. The other approach is to create a snapshot of volumes. This approach is generic and works on pretty much everything. For example, you can use this <a href="https://github.com/loomchild/volume-backup">3rd Party Project</a>. However, before running this, to avoid data corruption, you need to make sure that your containers are stopped <code>docker service ls --format {{.Name}} | while read in; do docker service scale &quot;$in&quot;=0; done</code> and then take a snapshot then resume all services <code>docker service ls --format {{.Name}} | while read in; do docker service scale &quot;$in&quot;=1; done</code>. In near future, CapRover will have a built-in solution like this.
Other useful tools for backing up your persistent directories are:</li>
</ol>
<ul>
<li><a href="https://github.com/futurice/docker-volume-backup">https://github.com/futurice/docker-volume-backup</a></li>
<li><a href="https://github.com/loomchild/volume-backup">https://github.com/loomchild/volume-backup</a></li>
<li><a href="https://github.com/blacklabelops/volumerize">https://github.com/blacklabelops/volumerize</a></li>
<li><a href="https://github.com/schickling/dockerfiles/tree/master/postgres-backup-s3">https://github.com/schickling/dockerfiles/tree/master/postgres-backup-s3</a></li>
<li><a href="https://github.com/schickling/dockerfiles/tree/master/mysql-backup-s3">https://github.com/schickling/dockerfiles/tree/master/mysql-backup-s3</a></li>
</ul>
<p><details>
<summary>Docker Registry</summary></p>
<h3><a class="anchor" aria-hidden="true" id="docker-registry-instructions"></a><a href="#docker-registry-instructions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Registry Instructions</h3>
<p>As noted above, container images are not part of the backup. To ensure that your apps do not require a re-deploy after the restoration process, you need to make sure that you're using a Docker Registry. A Docker Registry is a place where images for your apps will be stored.</p>
<h4><a class="anchor" aria-hidden="true" id="3rd-party-registry"></a><a href="#3rd-party-registry" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3rd Party Registry</h4>
<p>If you set the &quot;default push registry&quot; in your CapRover dashboard under Cluster section, every image will get pushed to the registry once it's built on the server. This is the best option as it's a separate entity and you are not responsible for keeping your images. Once you restore your CapRover instance, everything just works like a charm!</p>
<h4><a class="anchor" aria-hidden="true" id="self-hosted-registry"></a><a href="#self-hosted-registry" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Self Hosted Registry</h4>
<p>If you set the &quot;default push registry&quot; to CapRover self-hosted registry, your app will work out of the box after the restoration process. However, on the negative side, your <code>backup.tar</code> will be very big. This file will include all images that are built on your server.</p>
<p>If you had previously set the self-hosted registry, but you changed your mind and disabled the self-hosted registry to switched to a 3rd party registry, your backup files will still be big as the files are still sitting on your host system. If you want to purge all images stored in your registry, delete the registry directory <code>rm -rf /captain/data/registry</code></p>
<p></details></p>
<p><details>
<summary>Multi-Node setup</summary></p>
<h3><a class="anchor" aria-hidden="true" id="multi-nodes"></a><a href="#multi-nodes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multi Nodes</h3>
<p>What happens when you have a cluster? Backup and restoration process is pretty much the same as single node, except during the restoration, the first run exits after it detects that you're trying to restore a cluster. Your are asked to edit a file and add IP addresses of new nodes.</p>
<p>For example, previously you had 2 nodes:</p>
<ul>
<li>222.222.222.10 (Main node)</li>
<li>222.222.222.11</li>
</ul>
<p>For restoration you have prepared 2 nodes:</p>
<ul>
<li>222.222.222.20 (Main node)</li>
<li>222.222.222.21</li>
</ul>
<p>You run the restoration script on <code>222.222.222.20</code> and the script exits asking you to enter the information for the second node. You edit the restoration instructions file and enter <code>222.222.222.21</code> as the new IP for the old IP of <code>222.222.222.11</code>.</p>
<p>Next, you need to copy your private key (usually named <code>id_rsa</code>) to your server. For example, on linux:</p>
<pre><code class="hljs css language-bash">scp /home/myuser/.ssh/id_rsa root@123.123.123.123:/captain/
</code></pre>
<p><em>Make sure to delete this file from the server once the restoration process is finished</em></p>
<p>Now re-run the restoration script (the same one that exited and asked for more info). Now this process goes through and your nodes will be restored, apps will be adjusted to move to the new nodes. For example if previously, you had a persistent app locked on the second node, it'll be locked to the second node in the restored instance as well.</p>
<p>Volume restoration for the cluster is a bit more complicated. But if you are using a cluster, you probably know what you are doing :-)</p>
<p></details></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/best-practices.html"><span class="arrow-prev">← </span><span>Best Practices</span></a><a class="docs-next button" href="/docs/recipe-deploy-create-react-app.html"><span>Static React App</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="CapRover" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/get-started.html">Getting Started</a></div><div><h5>Community</h5><a href="https://twitter.com/cap_rover" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://join.slack.com/t/caprover/shared_invite/zt-2qlb28drp-RpxNfY3nUhroLuRJUUJzDA" target="_blank" rel="noreferrer noopener">Slack Group</a></div><div><h5>More</h5><a href="https://github.com/caprover/caprover" target="_blank">GitHub</a><a class="github-button" href="https://github.com/caprover/caprover" data-icon="octicon-star" data-count-href="/caprover/caprover/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2025 githubsaturn</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '81e546c2e0c9258e48c359465bde6909',
                indexName: 'caprover',
                inputSelector: '#search_input_react'
              });
            </script></body></html>