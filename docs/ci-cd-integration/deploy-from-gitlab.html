<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Deploying from Gitlab · CapRover</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="In this tutorial, we&#x27;ll go over the deployment via GitLab. Having said that, GitHub is very similar. If you have any issues along the way, let us know!"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Deploying from Gitlab · CapRover"/><meta property="og:type" content="website"/><meta property="og:url" content="https://caprover.com/index.html"/><meta property="og:description" content="In this tutorial, we&#x27;ll go over the deployment via GitLab. Having said that, GitHub is very similar. If you have any issues along the way, let us know!"/><meta property="og:image" content="https://caprover.com/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://caprover.com/img/logo.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-132762521-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="CapRover"/><h2 class="headerTitleWithLogo">CapRover</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/get-started.html" target="_self">Docs</a></li><li class=""><a href="https://github.com/caprover/caprover" target="_self">GitHub</a></li><li class=""><a href="https://join.slack.com/t/caprover/shared_invite/zt-2qlb28drp-RpxNfY3nUhroLuRJUUJzDA" target="_self">Slack Group</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>CI/CD Integration</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Basics</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/get-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/cdd-migration.html">CaptainDuckDuck Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/captain-definition-file.html">Captain Definition File</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment-methods.html">Deployment Methods</a></li><li class="navListItem"><a class="navItem" href="/docs/app-configuration.html">App Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/persistent-apps.html">Persistent Apps</a></li><li class="navListItem"><a class="navItem" href="/docs/cli-commands.html">CLI Commands</a></li><li class="navListItem"><a class="navItem" href="/docs/one-click-apps.html">One-Click Apps</a></li><li class="navListItem"><a class="navItem" href="/docs/complete-webapp-tutorial.html">Complete Webapp Tutorial</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Do More</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/resource-monitoring.html">Resource Monitoring</a></li><li class="navListItem"><a class="navItem" href="/docs/nginx-customization.html">NGINX Config</a></li><li class="navListItem"><a class="navItem" href="/docs/service-update-override.html">Service Update Override</a></li><li class="navListItem"><a class="navItem" href="/docs/app-scaling-and-cluster.html">App Scaling &amp; Cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/pre-deploy-script.html">Pre-deploy Script</a></li><li class="navListItem"><a class="navItem" href="/docs/play-with-docker.html">Play with CapRover</a></li><li class="navListItem"><a class="navItem" href="/docs/run-locally.html">Run Locally</a></li><li class="navListItem"><a class="navItem" href="/docs/certbot-config.html">Certbot Overrides</a></li><li class="navListItem"><a class="navItem" href="/docs/theme-customization.html">Custom Themes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Recipes and Tips</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/sample-apps.html">Sample Apps</a></li><li class="navListItem"><a class="navItem" href="/docs/zero-downtime.html">Zero Downtime</a></li><li class="navListItem"><a class="navItem" href="/docs/database-connection.html">Database Connection</a></li><li class="navListItem"><a class="navItem" href="/docs/best-practices.html">Best Practices</a></li><li class="navListItem"><a class="navItem" href="/docs/backup-and-restore.html">Backup &amp; Restore</a></li><li class="navListItem"><a class="navItem" href="/docs/recipe-deploy-create-react-app.html">Static React App</a></li><li class="navListItem"><a class="navItem" href="/docs/stateless-with-persistent-data.html">Stateless with Persistent data</a></li><li class="navListItem"><a class="navItem" href="/docs/docker-compose.html">Docker Compose</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">CI/CD Integration</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ci-cd-integration.html">Intro</a></li><li class="navListItem"><a class="navItem" href="/docs/ci-cd-integration/deploy-from-github.html">Deploy from GitHub</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/ci-cd-integration/deploy-from-gitlab.html">Deploy from GitLab</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Help</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Server Purchase</h4><ul><li class="navListItem"><a class="navItem" href="/docs/server-purchase/digitalocean.html">DigitalOcean</a></li><li class="navListItem"><a class="navItem" href="/docs/server-purchase/openstack.html">OpenStack</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/disk-cleanup.html">Disk Clean-Up</a></li><li class="navListItem"><a class="navItem" href="/docs/firewall.html">Firewall &amp; Port Forwarding</a></li><li class="navListItem"><a class="navItem" href="/docs/troubleshooting.html">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/docs/troubleshooting-pro.html">Troubleshooting (Pro)</a></li><li class="navListItem"><a class="navItem" href="/docs/support.html">Help and Support</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/caprover/caprover-website/edit/master/docs/ci-cd-integration/deploy-from-gitlab.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Deploying from Gitlab</h1></header><article><div><span><p>In this tutorial, we'll go over the deployment via GitLab. Having said that, GitHub is very similar. If you have any issues along the way, let us know!</p>
<h3><a class="anchor" aria-hidden="true" id="1--create-gitlab-repository"></a><a href="#1--create-gitlab-repository" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1- Create GitLab Repository</h3>
<p>If you don't have a GitLab account, create an account.</p>
<ul>
<li>Click on &quot;New Project&quot; to create a new repository</li>
<li>Click on &quot;Create blank project&quot;</li>
<li>Name your project and finish your project creation</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="2--add-sample-source-code"></a><a href="#2--add-sample-source-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2- Add Sample Source Code</h3>
<p>For this tutorial we'll work with a very easy sample source code containing one file</p>
<p><code>index.php</code></p>
<pre><code class="hljs css language-php"> <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">'PHP output: Hello World!'</span>; <span class="hljs-meta">?&gt;</span> 
</code></pre>
<p>Add, commit and push this file to your repository on GitLab. You should be seeing this file on the web UI of GitLab.</p>
<h3><a class="anchor" aria-hidden="true" id="3--dockerfile"></a><a href="#3--dockerfile" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3- Dockerfile</h3>
<p>In order to build on a 3rd party build system, you need to have a Dockerfile. If you're using a CapRover templateId, you can use the ready to go <a href="https://github.com/caprover/caprover/tree/ff3d124f967ee06732c13774e9e633d33b0982c4/dockerfiles">Dockerfiles that are in CapRover repository</a>.</p>
<p>In this tutorial, we'll use the PHP Dockerfile:</p>
<p><code>Dockerfile</code></p>
<pre><code class="hljs css language-Dockerfile"><span class="hljs-keyword">FROM</span> php:<span class="hljs-number">7.3</span>-apache
<span class="hljs-keyword">COPY</span><span class="bash"> ./ /var/www/html/</span>
</code></pre>
<p><strong>IMPORTANT</strong> Make sure your <code>Dockerfile</code> is spelled exactly as this.</p>
<p>Add, commit and push this file.</p>
<h3><a class="anchor" aria-hidden="true" id="4--create-an-access-token-for-caprover"></a><a href="#4--create-an-access-token-for-caprover" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4- Create an Access Token for CapRover</h3>
<p>CapRover needs to pull the built images from GitLab, so we need to create an access token. Navigate to <a href="https://gitlab.com/-/profile/personal_access_tokens">https://gitlab.com/-/profile/personal_access_tokens</a> and create a token.</p>
<p>Make sure to assign <code>read_registry</code> and <code>write_registry</code> permissions for this token.</p>
<p>One you created the token move to the next step:</p>
<h3><a class="anchor" aria-hidden="true" id="5--add-token-to-caprover"></a><a href="#5--add-token-to-caprover" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5- Add Token to CapRover</h3>
<p>Login to your CapRover web dashboard, under <code>Cluster</code> click on <code>Add Remote Registry</code>. Then enter these fields:</p>
<ul>
<li>Username: <code>your gitlab username</code></li>
<li>Password: <code>your gitlab Token [From the previous step]</code></li>
<li>Domain: <code>registry.gitlab.com</code></li>
<li>Image Prefix: <code>again, your gitlab username</code></li>
</ul>
<p>NOTE: Image Prefix depends on how you structure your project in Gitlab. If you are using a group for your repository, your image prefix should be your group.
In general, image prefix is the part between the domain and image name. For example, <code>my-group-project</code> is the Image Prefix for this project:</p>
<pre><code class="hljs">registry.gitlab.com/my-group-<span class="hljs-keyword">project</span>/<span class="hljs-keyword">test</span>:latest
</code></pre>
<p>Save your registry.</p>
<h3><a class="anchor" aria-hidden="true" id="6--disable-default-push"></a><a href="#6--disable-default-push" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6- Disable Default Push</h3>
<p>Now that you added a registry, CapRover by default wants to push the built artifact to your registry. You do not need this for this tutorial, and it might make your deployments to fail. So go ahead and disable <code>Default Push</code></p>
<h3><a class="anchor" aria-hidden="true" id="7--create-a-caprover-app"></a><a href="#7--create-a-caprover-app" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7- Create a CapRover App</h3>
<p>On CapRover dashboard and create an app, we call it <code>my-test-gitlab-deploy</code></p>
<h3><a class="anchor" aria-hidden="true" id="8--create-cicd-variables"></a><a href="#8--create-cicd-variables" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8- Create CI/CD Variables</h3>
<p>Next, go to your project page on GitLab, navigate to <code>Settings &gt; CI/CD</code>. Then, under <code>Variables</code> add the following variables:</p>
<ul>
<li><code>Key</code> : <code>CAPROVER_URL</code> , <code>Value</code> : <code>https://captain.root.domain.com [replace it with your domain]</code></li>
<li><code>Key</code> : <code>CAPROVER_PASSWORD</code> , <code>Value</code> : <code>mYpAsSwOrD [replace it with your password]</code></li>
<li><code>Key</code> : <code>CAPROVER_APP</code> , <code>Value</code> : <code>my-test-gitlab-deploy [replace it with your app name]</code></li>
</ul>
<p>Add all these 3 variables. For best security make sure they are they are protected. It's okay if they are not masked, they won't appear in logs.</p>
<h3><a class="anchor" aria-hidden="true" id="9--gitlab-ci-file"></a><a href="#9--gitlab-ci-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>9- GitLab CI File</h3>
<p>So far, we have two files in our directory <code>index.php</code> and <code>Dockerfile</code>. Now let's add GitLab's specific build instructions:</p>
<p><strong>IMPORTANT</strong> Make sure your <code>.gitlab-ci.yml</code> is spelled exactly as this. It starts with a dot.</p>
<p><code>.gitlab-ci.yml</code></p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">build-docker-master:</span>
  <span class="hljs-attr">image:</span> <span class="hljs-string">docker:19.03.1</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">build</span>
  <span class="hljs-attr">services:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">docker:19.03.1-dind</span>
  <span class="hljs-attr">before_script:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">DOCKER_REGISTRY_USER=$CI_REGISTRY_USER</span> <span class="hljs-comment"># built-in GitLab Registry User</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">DOCKER_REGISTRY_PASSWORD=$CI_REGISTRY_PASSWORD</span> <span class="hljs-comment"># built-in GitLab Registry Password</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">DOCKER_REGISTRY_URL=$CI_REGISTRY</span> <span class="hljs-comment"># built-in GitLab Registry URL</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">COMMIT_HASH=$CI_COMMIT_SHA</span> <span class="hljs-comment"># Your current commit sha</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">IMAGE_NAME_WITH_REGISTRY_PREFIX=$CI_REGISTRY_IMAGE</span> <span class="hljs-comment"># Your repository prefixed with GitLab Registry URL</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">docker</span> <span class="hljs-string">login</span> <span class="hljs-string">-u</span> <span class="hljs-string">"$DOCKER_REGISTRY_USER"</span> <span class="hljs-string">-p</span> <span class="hljs-string">"$DOCKER_REGISTRY_PASSWORD"</span> <span class="hljs-string">$DOCKER_REGISTRY_URL</span> <span class="hljs-comment"># Instructs GitLab to login to its registry</span>

  <span class="hljs-attr">script:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"Building..."</span> <span class="hljs-comment"># MAKE SURE NO SPACE ON EITHER SIDE OF = IN THE FOLLOWING LINE</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">CONTAINER_FULL_IMAGE_NAME_WITH_TAG=$IMAGE_NAME_WITH_REGISTRY_PREFIX/my-build-image:$COMMIT_HASH</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">docker</span> <span class="hljs-string">build</span> <span class="hljs-string">-f</span> <span class="hljs-string">./Dockerfile</span> <span class="hljs-string">--pull</span> <span class="hljs-string">-t</span> <span class="hljs-string">built-image-name</span> <span class="hljs-string">.</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">docker</span> <span class="hljs-string">tag</span> <span class="hljs-string">built-image-name</span> <span class="hljs-string">"$CONTAINER_FULL_IMAGE_NAME_WITH_TAG"</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">docker</span> <span class="hljs-string">push</span> <span class="hljs-string">"$CONTAINER_FULL_IMAGE_NAME_WITH_TAG"</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">$CONTAINER_FULL_IMAGE_NAME_WITH_TAG</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"Deploying on CapRover..."</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">caprover/cli-caprover:v2.1.1</span> <span class="hljs-string">caprover</span> <span class="hljs-string">deploy</span> <span class="hljs-string">--caproverUrl</span> <span class="hljs-string">$CAPROVER_URL</span> <span class="hljs-string">--caproverPassword</span> <span class="hljs-string">$CAPROVER_PASSWORD</span> <span class="hljs-string">--caproverApp</span> <span class="hljs-string">$CAPROVER_APP</span> <span class="hljs-string">--imageName</span> <span class="hljs-string">$CONTAINER_FULL_IMAGE_NAME_WITH_TAG</span>
  <span class="hljs-attr">only:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">master</span>
</code></pre>
<p>This is quite self-explanatory. <strong>The best part is that you don't have to make any changes to this file!</strong> It is the same file for all of your repositories regardless of their language or where you deploy them!</p>
<p>The only 3 values that are different for this file, are the 3 <code>CAPROVER_***</code> values that you set in the previous step.</p>
<p>Commit and push this file to your GitLab repository. By now, your GitLab repository must have at least these 3 files</p>
<pre><code class="hljs css language-bash">index.php
Dockerfile
.gitlab-ci.yml
</code></pre>
<p>Wait a little bit until your build is finished and deployed automatically! After a few minutes you can see your deployed app on CapRover!!!</p>
<h4><a class="anchor" aria-hidden="true" id="note-on-using---imagename-with-a-private-registry"></a><a href="#note-on-using---imagename-with-a-private-registry" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Note on using <code>--imageName</code> with a private registry</h4>
<p>If you encounter the following error when running <code>caprover deploy --imageName</code>, you may need to authenticate your Captain instance with your registry, as being logged in locally doesn't mean that CapRover can access the image.</p>
<pre><code class="hljs">Deploy failed!
Error: (HTTP code 404) unexpected - pull access denied <span class="hljs-keyword">for</span> user_name/repo_name, repository does <span class="hljs-keyword">not</span> exist <span class="hljs-keyword">or</span> may require <span class="hljs-string">'docker login'</span>: denied: requested access <span class="hljs-keyword">to</span> the<span class="hljs-built_in"> resource </span>is denied
</code></pre>
<p><strong>Log in to your private Docker repository on CapRover</strong>:</p>
<ul>
<li>Navigate to CLUSTER</li>
<li>Click on ADD REMOTE REGISTRY</li>
<li>Enter your data and save your registry</li>
<li>Now you can use <code>caprover deploy --imageName</code> with your private image registry.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="app-tokens"></a><a href="#app-tokens" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>App Tokens</h4>
<p>When you use CI/CD, it may be more desirable to avoid storing your password. Instead, you can create app specific tokens to deployment of each app.</p>
<pre><code class="hljs">caprover <span class="hljs-keyword">deploy</span> <span class="hljs-params">--appToken</span> &lt;YOUR_APP_TOKEN_HERE&gt; <span class="hljs-params">--caproverUrl</span> https:<span class="hljs-string">//captain.domain.com</span> <span class="hljs-params">--imageName</span> YOUR_IMAGE_NAME <span class="hljs-params">--appName</span> YOUR_APP_NAME
</code></pre>
<p>Usually it is more secure to save token in an environment variable, CLI will load it from <code>CAPROVER_APP_TOKEN</code> variable.</p>
<p>This functionality is available from CapRover 1.10 backend and CapRover CLI version of 2.2.0!</p>
<h4><a class="anchor" aria-hidden="true" id="alternative-method"></a><a href="#alternative-method" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alternative Method</h4>
<p>Alternatively, you can use a webhook instead of <code>docker run caprover/cli-caprover:v2.1.1 caprover deploy....</code>. This method is a bit more complex.</p>
<p>The following is NOT A WORKING example. Instead, it's just a hint on what steps are needed for the webhook method to work.</p>
<pre><code class="hljs css language-bash">    - <span class="hljs-built_in">echo</span> <span class="hljs-string">"Deploying on CapRover..."</span>
    - <span class="hljs-built_in">export</span> DEPLOY_BRANCH=deploy-caprover
    - <span class="hljs-built_in">cd</span> ~
    - git <span class="hljs-built_in">clone</span> your-repo
    - <span class="hljs-built_in">cd</span> your-repo
    - git checkout <span class="hljs-variable">$DEPLOY_BRANCH</span> || git checkout -b <span class="hljs-variable">$DEPLOY_BRANCH</span>
    - git rm -rf .
    - git clean -fdx .
    - <span class="hljs-built_in">echo</span> <span class="hljs-string">"{\"schemaVersion\":2,\"imageName\":\"<span class="hljs-variable">$CONTAINER_FULL_IMAGE_NAME_WITH_TAG</span>\"}"</span> &gt; captain-definition
    - git add .
    - git commit -m <span class="hljs-string">"Deploy <span class="hljs-variable">$CONTAINER_FULL_IMAGE_NAME_WITH_TAG</span>"</span>
    - git push --<span class="hljs-built_in">set</span>-upstream origin <span class="hljs-variable">$DEPLOY_BRANCH</span>
    - curl -X POST https://captain.rootdomain.com/your-webhook
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/ci-cd-integration/deploy-from-github.html"><span class="arrow-prev">← </span><span class="function-name-prevnext">Deploy from GitHub</span></a><a class="docs-next button" href="/docs/server-purchase/digitalocean.html"><span class="function-name-prevnext">DigitalOcean</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="CapRover" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/get-started.html">Getting Started</a></div><div><h5>Community</h5><a href="https://twitter.com/cap_rover" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://join.slack.com/t/caprover/shared_invite/zt-2qlb28drp-RpxNfY3nUhroLuRJUUJzDA" target="_blank" rel="noreferrer noopener">Slack Group</a></div><div><h5>More</h5><a href="https://github.com/caprover/caprover" target="_blank">GitHub</a><a class="github-button" href="https://github.com/caprover/caprover" data-icon="octicon-star" data-count-href="/caprover/caprover/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2025 githubsaturn</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '81e546c2e0c9258e48c359465bde6909',
                indexName: 'caprover',
                inputSelector: '#search_input_react'
              });
            </script></body></html>